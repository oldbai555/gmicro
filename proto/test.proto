// 指定proto版本
syntax = "proto3";

// 指定golang包名
option go_package = "gmicro/service/test";

import "base.proto";
import "validate.proto";

// 指定默认包名
package test;

// 定义 lboss 服务
service test {

    // @cat: File
    // @name:
    // @desc:
    // @error:
    rpc AddFile (AddFileReq) returns (AddFileRsp) {
        option(base.ModelName) = "File";
        option(base.GenCRUDSvrRpcTemp) = "ADD";
        option(base.CodeGenRpcFuncFileName) = "file_api";
    };

    // @cat: File
    // @name:
    // @desc:
    // @error:
    rpc DelFileList (DelFileListReq) returns (DelFileListRsp) {
        option(base.ModelName) = "File";
        option(base.GenCRUDSvrRpcTemp) = "DELETE";
        option(base.CodeGenRpcFuncFileName) = "file_api";
    };

    // @cat: File
    // @name:
    // @desc:
    // @error:
    rpc UpdateFile (UpdateFileReq) returns (UpdateFileRsp) {
        option(base.ModelName) = "File";
        option(base.GenCRUDSvrRpcTemp) = "UPDATE";
        option(base.CodeGenRpcFuncFileName) = "file_api";
    };

    // @cat: File
    // @name:
    // @desc:
    // @error:
    rpc GetFile (GetFileReq) returns (GetFileRsp) {
        option(base.ModelName) = "File";
        option(base.GenCRUDSvrRpcTemp) = "GET";
        option(base.CodeGenRpcFuncFileName) = "file_api";
    };

    // @cat: File
    // @name:
    // @desc:
    // @error:
    rpc GetFileList (GetFileListReq) returns (GetFileListRsp) {
        option(base.ModelName) = "File";
        option(base.GenCRUDSvrRpcTemp) = "LIST";
        option(base.CodeGenRpcFuncFileName) = "file_api";
    };

}
// lboss 150000 - 160000, 20013
enum ErrCode {
    Success = 0;
    ErrFileNotFound = 150001 ;// 文件不存在
}

// 文件表
message ModelFile {
    uint64 id = 1;
    uint32 created_at = 2;
    uint32 updated_at = 3;
    uint32 deleted_at = 4;
    uint64 creator_id = 5;
    int64 size = 6;
    // @desc: 原文件名
    string name = 7;
    // @desc: 文件重命名
    string rename = 8;
    // @desc: 文件路径
    string path = 9;
    // @desc: 存储桶
    string bucket = 10;
    // @desc: 域名
    string domain = 11;
}


message AddFileReq {
    ModelFile data = 1 [(validate.rules).message = {required:true}];
}

message AddFileRsp {
    ModelFile data = 1;
}

message UpdateFileReq {
    ModelFile data = 1 [(validate.rules).message = {required:true}];
}

message UpdateFileRsp {
}

message DelFileListReq {
    // @ref_to: GetFileListReq.ListOption
    base.ListOption list_option = 1 [(validate.rules).message = {required:true}];
}

message DelFileListRsp {
}

message GetFileReq {
    uint64 id = 1 [(validate.rules).uint64 = {gt:0}];
}

message GetFileRsp {
    ModelFile data = 1;
}

message GetFileListReq {
    enum ListOption {
        ListOptionNil = 0;
    }
    base.ListOption list_option = 1 [(validate.rules).message = {required:true}];
}

message GetFileListRsp {
    base.Paginate paginate = 1;
    repeated ModelFile list = 2;
}
